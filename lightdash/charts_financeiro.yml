---
version: 2

# Anchors para configurações comuns
x-sort: &default-mes-sort
  sorts:
    - field: mes_key
      descending: false

x-filter-period: &filter-12-months
  filters:
    - field: mes_key
      operator: in_date_range
      values: ["12 months"]

x-filter-credito: &filter-credito
  filters:
    - field: tipo_operacao
      operator: equals
      values: ["credito"]

x-filter-debito: &filter-debito
  filters:
    - field: tipo_operacao
      operator: equals
      values: ["debito"]

charts:
  # 1) Créditos vs Débitos por Mês - Visão Comparativa
  - name: "Créditos vs Débitos por Mês"
    description: >-
      Comparativo mensal de entradas (créditos) e saídas (débitos).
    table_name: fct_transacoes
    chart_kind: column
    config:
      x_field: mes_key
      x_label: "Mês"
      series:
        - field: total_creditos
          label: "Créditos"
        - field: total_debitos
          label: "Débitos"
      <<: *default-mes-sort
    dimensions:
      - mes_key
    metrics:
      - total_creditos
      - total_debitos

  # 2) Evolução do Saldo Líquido
  - name: "Saldo Líquido por Mês"
    description: >-
      Evolução do resultado líquido mensal (créditos - débitos).
    table_name: fct_transacoes
    chart_kind: line
    config:
      x_field: mes_key
      series:
        - field: saldo_liquido
          label: "Saldo Líquido"
      <<: *default-mes-sort
    dimensions:
      - mes_key
    metrics:
      - saldo_liquido

  # 3) Análise de Receitas por Empresa
  - name: "Receitas por Empresa (12m)"
    description: >-
      Distribuição de créditos por empresa nos últimos 12 meses.
    table_name: fct_transacoes
    chart_kind: bar
    config:
      x_field: empresa
      series:
        - field: total_creditos
          label: "Créditos"
      sorts:
        - field: total_creditos
          descending: true
    dimensions:
      - empresa
    metrics:
      - total_creditos
    <<: *filter-12-months

  # 4) Ranking de Pagamentos de Pizza
  - name: "Top Pagadores - Pizza (Mensal)"
    description: >-
      Ranking dos maiores pagamentos relacionados a Pizza por mês.
    table_name: fct_transacoes
    chart_kind: table
    config:
      sorts:
        - field: total_creditos
          descending: true
      limit: 5
    dimensions:
      - mes_key
      - descricao
    metrics:
      - total_creditos
    filters:
      - field: descricao
        operator: contains
        values: ["Pizza"]
    <<: *filter-credito

  # 5) Distribuição de Despesas por Tipo
  - name: "Distribuição de Débitos por Tipo de Transação"
    description: >-
      Análise da composição de débitos por categoria de transação.
    table_name: fct_transacoes
    chart_kind: pie
    config:
      series:
        - field: pagamentos
          label: "Débitos"
    dimensions:
      - tipo_transacao
    metrics:
      - pagamentos
    <<: *filter-debito

  # 6) Detalhamento de Transações
  - name: "Transações Detalhadas"
    description: >-
      Visualização detalhada de todas as transações com filtros.
    table_name: fct_transacoes
    chart_kind: table
    config:
      columns:
        - data
        - empresa
        - conta
        - tipo_operacao
        - tipo_transacao
        - titulo
        - descricao
        - valor
        - valor_signed
      sorts:
        - field: data
          descending: true
    dimensions:
      - data
      - empresa
      - conta
      - tipo_operacao
      - tipo_transacao
      - titulo
      - descricao
    metrics:
      - valor
      - valor_signed
